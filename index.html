<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Groove Browser</title>
    <style>
        /* --- CORE DESIGN SYSTEM --- */
        :root {
            --bg-dark: #09090b;
            --bg-gradient: radial-gradient(circle at 50% 0%, #1c1c2e, #09090b 55%);
            --glass-surface: rgba(20, 20, 28, 0.85);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.15);
            --glass-blur: blur(24px);
            --accent: #5e81ac;
            --accent-glow: rgba(94, 129, 172, 0.4);
            --success: #a3be8c;
            --danger: #bf616a;
            --text-primary: #eceff4;
            --text-secondary: #9fa6b2;
            --radius-xl: 28px;
            --radius-lg: 18px;
            --nav-height: 64px;
            --anim-ease: cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* --- RESET --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            background: var(--bg-dark);
            background-image: var(--bg-gradient);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- UTILITY --- */
        .glass {
            background: var(--glass-surface);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
        }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.3s var(--anim-ease) forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- TOP BAR --- */
        header {
            height: var(--nav-height); padding: 8px 12px;
            display: flex; align-items: center; gap: 10px; z-index: 100;
        }

        .omnibar {
            flex: 1; height: 46px; border-radius: var(--radius-xl);
            display: flex; align-items: center; padding: 0 16px;
            position: relative; overflow: hidden;
            transition: 0.3s var(--anim-ease);
        }
        .omnibar:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-glow);
            background: rgba(255,255,255,0.08);
        }

        #security-indicator {
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--text-secondary); margin-right: 10px;
            transition: background 0.3s, box-shadow 0.3s;
        }
        #security-indicator.secure { background: var(--success); box-shadow: 0 0 8px rgba(163, 190, 140, 0.4); }
        #security-indicator.insecure { background: var(--danger); box-shadow: 0 0 8px rgba(191, 97, 106, 0.4); }

        #url-input {
            flex: 1; background: transparent; border: none;
            color: var(--text-primary); font-size: 15px; font-weight: 500;
            width: 100%; height: 100%;
        }

        #loader {
            position: absolute; bottom: 0; left: 0; height: 2px; width: 0%;
            background: var(--accent); box-shadow: 0 0 10px var(--accent);
            transition: width 0.2s ease, opacity 0.3s;
        }

        /* --- VIEWPORT (Tabs Container) --- */
        #viewport {
            flex: 1; position: relative; margin: 0 10px;
            border-radius: var(--radius-lg); overflow: hidden;
            background: #fff; /* White base for web content */
        }
        
        .tab-frame {
            width: 100%; height: 100%; border: none; display: block; background: #fff;
        }
        
        /* Empty State / Home */
        .home-view {
            position: absolute; inset: 0;
            background: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 50%, #151520, #000);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 50;
        }
        .brand { font-size: 42px; font-weight: 800; letter-spacing: -2px; margin-bottom: 40px; background: linear-gradient(to right, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}

        /* --- BOTTOM NAV --- */
        nav {
            height: 70px; padding: 0 16px;
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid var(--glass-border); z-index: 100;
        }

        .nav-btn {
            width: 48px; height: 48px; border-radius: 50%;
            background: transparent; border: none; color: var(--text-primary);
            display: grid; place-items: center; position: relative;
            transition: 0.2s;
        }
        .nav-btn:active { background: rgba(255,255,255,0.1); transform: scale(0.9); }
        .nav-btn svg { width: 22px; height: 22px; fill: currentColor; }
        
        /* Tab Counter Badge */
        #tab-count-badge {
            position: absolute; font-size: 11px; font-weight: 700;
            border: 1.5px solid var(--bg-dark);
            width: 20px; height: 20px; line-height: 18px;
            text-align: center; border-radius: 6px;
            top: 14px; left: 14px; background: var(--text-primary); color: #000;
            pointer-events: none;
        }

        /* --- TAB SWITCHER OVERLAY --- */
        #tab-switcher {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 800; display: none; flex-direction: column;
            padding: 20px; animation: slideUp 0.3s var(--anim-ease);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .switcher-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }
        .switcher-title { font-size: 20px; font-weight: 700; }
        
        .tab-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
            overflow-y: auto; flex: 1; padding-bottom: 80px;
        }

        .tab-card {
            background: rgba(255,255,255,0.05); border-radius: 16px;
            height: 160px; position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.2s; display: flex; flex-direction: column;
        }
        .tab-card.active-card {
            border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow);
        }
        .tab-card-preview {
            flex: 1; background: #222; display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #444; font-weight: 800;
        }
        .tab-card-info {
            height: 40px; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            display: flex; align-items: center; padding: 0 10px;
            font-size: 12px; justify-content: space-between;
        }
        .tab-card-title {
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%;
        }
        .tab-close-btn {
            width: 20px; height: 20px; border-radius: 50%; background: rgba(255,255,255,0.2);
            display: grid; place-items: center; color: #fff; font-size: 14px;
        }

        .fab-add {
            position: absolute; bottom: 30px; right: 30px;
            width: 60px; height: 60px; border-radius: 30px;
            background: var(--accent); color: white;
            box-shadow: 0 4px 20px var(--accent-glow);
            border: none; font-size: 24px; display: grid; place-items: center;
        }

        /* --- SETTINGS SHEET --- */
        #overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px); z-index: 900;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            display: flex; align-items: flex-end;
        }
        #overlay.active { opacity: 1; pointer-events: auto; }
        #sheet {
            width: 100%; background: #13131a;
            border-top: 1px solid var(--glass-highlight);
            border-radius: 24px 24px 0 0; padding: 24px;
            transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }
        #overlay.active #sheet { transform: translateY(0); }
        .setting-item { display: flex; justify-content: space-between; padding: 16px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
        .switch { width: 46px; height: 26px; background: rgba(255,255,255,0.15); border-radius: 13px; position: relative; transition: 0.3s; }
        .switch::after { content:''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: 0.3s; }
        .switch.on { background: var(--success); }
        .switch.on::after { transform: translateX(20px); }

        /* --- TOAST --- */
        #toast {
            position: fixed; top: 90px; left: 50%; transform: translate(-50%, -20px);
            background: rgba(30,30,30,0.95); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 30px; font-size: 13px;
            opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1000;
            border: 1px solid rgba(255,255,255,0.1);
        }
        #toast.vis { transform: translate(-50%, 0); opacity: 1; }
    </style>
</head>
<body>

    <header class="glass">
        <div class="omnibar glass">
            <div id="security-indicator"></div>
            <input type="text" id="url-input" placeholder="Search or Type URL" autocomplete="off">
            <div id="loader"></div>
        </div>
    </header>

    <div id="viewport">
        <div id="home-template" class="home-view hidden">
            <div class="brand">Groove</div>
            <div style="display: flex; gap: 10px; margin-top:20px;">
                <button onclick="Groove.nav('https://duckduckgo.com')" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #333; background: transparent; color: #888;">DuckDuckGo</button>
                <button onclick="Groove.nav('https://google.com')" style="padding: 8px 16px; border-radius: 20px; border: 1px solid #333; background: transparent; color: #888;">Google</button>
            </div>
            <p style="color:#444; font-size:12px; margin-top:40px;">Safe. Private. Encrypted.</p>
        </div>
    </div>

    <nav class="glass">
        <button class="nav-btn" id="btn-back"><svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
        <button class="nav-btn" id="btn-forward"><svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></button>
        <button class="nav-btn" id="btn-home" style="color:var(--accent)"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></button>
        
        <button class="nav-btn" id="btn-tabs">
            <div id="tab-count-badge">1</div>
            <svg viewBox="0 0 24 24"><path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/></svg>
        </button>

        <button class="nav-btn" id="btn-menu"><svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></button>
    </nav>

    <div id="tab-switcher">
        <div class="switcher-header">
            <span class="switcher-title">Tabs</span>
            <button onclick="Groove.toggleTabSwitcher()" style="background:transparent; border:none; color:var(--accent); font-weight:700;">Done</button>
        </div>
        <div class="tab-grid" id="tab-grid">
            </div>
        <button class="fab-add" onclick="Groove.newTab()">+</button>
    </div>

    <div id="overlay">
        <div id="sheet">
            <div style="width: 32px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 0 auto 24px;"></div>
            <h3 style="color:var(--text-primary); margin-bottom: 20px;">Groove Shield</h3>
            <div class="setting-item">
                <div><h4>Block Ads</h4><p style="color:#888; font-size:12px;">Aggressive filtering</p></div>
                <div class="switch on" id="tog-ads" onclick="Groove.toggleSet('ads')"></div>
            </div>
            <div class="setting-item">
                <div><h4>JavaScript</h4><p style="color:#888; font-size:12px;">Global Execution</p></div>
                <div class="switch on" id="tog-js" onclick="Groove.toggleSet('js')"></div>
            </div>
            <button onclick="localStorage.clear(); location.reload()" style="width:100%; margin-top:20px; padding:15px; background:var(--danger); border:none; color:white; border-radius:12px;">Clear All Data</button>
        </div>
    </div>

    <div id="toast">Notification</div>

    <script>
        // --- GROOVE CORE ---
        const $ = (id) => document.getElementById(id);

        class Tab {
            constructor(id) {
                this.id = id;
                this.history = [];
                this.idx = -1;
                this.title = "New Tab";
                this.url = "";
                
                // Create DOM elements
                this.frame = document.createElement('iframe');
                this.frame.className = 'tab-frame hidden';
                this.frame.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin');
                
                this.home = document.createElement('div');
                this.home.className = 'home-view hidden';
                this.home.innerHTML = $('home-template').innerHTML;

                $('viewport').appendChild(this.home);
                $('viewport').appendChild(this.frame);
            }

            load(url) {
                this.url = url;
                this.home.classList.add('hidden');
                this.frame.classList.remove('hidden');
                
                // Navigation Logic
                if (this.history[this.idx] !== url) {
                    this.idx++;
                    this.history = this.history.slice(0, this.idx);
                    this.history.push(url);
                }

                this.frame.src = url;
                this.title = url.replace(/(^\w+:|^)\/\//, '').split('/')[0] || "Browsing...";
                
                if (Groove.activeTabId === this.id) {
                    Groove.updateUI();
                }
            }

            goHome() {
                this.url = "";
                this.title = "New Tab";
                this.frame.classList.add('hidden');
                this.frame.src = ""; // Unload to save memory? Optional.
                this.home.classList.remove('hidden');
                if (Groove.activeTabId === this.id) Groove.updateUI();
            }

            show() {
                if(this.url) this.frame.classList.remove('hidden');
                else this.home.classList.remove('hidden');
            }

            hide() {
                this.frame.classList.add('hidden');
                this.home.classList.add('hidden');
            }
            
            destroy() {
                this.frame.remove();
                this.home.remove();
            }
        }

        const Groove = {
            tabs: [],
            activeTabId: null,
            settings: { ads: true, js: true },
            
            init: () => {
                Groove.newTab(); // Start with one tab
                
                // Event Listeners
                $('url-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        $('url-input').blur();
                        Groove.nav($('url-input').value);
                    }
                });

                $('btn-back').onclick = () => Groove.history(-1);
                $('btn-forward').onclick = () => Groove.history(1);
                $('btn-reload').onclick = () => { const t = Groove.getTab(); if(t.url) t.frame.src += ''; };
                $('btn-home').onclick = () => Groove.getTab().goHome();
                $('btn-tabs').onclick = () => Groove.toggleTabSwitcher();
                $('btn-menu').onclick = () => $('overlay').classList.add('active');
                $('overlay').onclick = (e) => { if(e.target === $('overlay')) $('overlay').classList.remove('active'); };
            },

            getTab: () => Groove.tabs.find(t => t.id === Groove.activeTabId),

            newTab: () => {
                const id = Date.now();
                const tab = new Tab(id);
                Groove.tabs.push(tab);
                Groove.switchTab(id);
                $('tab-switcher').style.display = 'none'; // Close switcher if open
                tab.goHome();
                Groove.renderTabGrid();
                Groove.updateBadge();
            },

            switchTab: (id) => {
                const current = Groove.getTab();
                if (current) current.hide();

                Groove.activeTabId = id;
                const next = Groove.getTab();
                next.show();
                Groove.updateUI();
                
                // Hide switcher
                $('tab-switcher').style.display = 'none';
            },

            closeTab: (id, e) => {
                if (e) e.stopPropagation();
                
                // Find index
                const idx = Groove.tabs.findIndex(t => t.id === id);
                if (idx === -1) return;

                const tab = Groove.tabs[idx];
                tab.destroy(); // DOM Cleanup
                Groove.tabs.splice(idx, 1);

                // If we closed the last tab, create a new one
                if (Groove.tabs.length === 0) {
                    Groove.newTab();
                } 
                // If we closed the active tab, switch to another
                else if (Groove.activeTabId === id) {
                    Groove.switchTab(Groove.tabs[Math.max(0, idx - 1)].id);
                }
                
                Groove.renderTabGrid();
                Groove.updateBadge();
            },

            nav: (raw) => {
                if(raw.startsWith('groove://inspect')) {
                    alert(JSON.stringify(Groove.getTab().history));
                    return;
                }
                
                let url = raw.trim();
                if (!url.includes('.') || url.includes(' ')) {
                    url = 'https://duckduckgo.com/?q=' + encodeURIComponent(raw);
                } else if (!url.startsWith('http')) {
                    url = 'https://' + url;
                }

                const tab = Groove.getTab();
                
                // Animation
                $('loader').style.width = '70%';
                $('loader').style.opacity = '1';
                setTimeout(() => { $('loader').style.width = '100%'; $('loader').style.opacity = '0'; }, 1000);

                tab.load(url);
            },

            history: (dir) => {
                const tab = Groove.getTab();
                if (!tab.url) return;
                
                if (dir === -1 && tab.idx > 0) {
                    tab.idx--;
                    tab.load(tab.history[tab.idx]);
                } else if (dir === 1 && tab.idx < tab.history.length - 1) {
                    tab.idx++;
                    tab.load(tab.history[tab.idx]);
                }
            },

            updateUI: () => {
                const tab = Groove.getTab();
                $('url-input').value = tab.url;
                
                // Security Icon
                const ind = $('security-indicator');
                if (tab.url.startsWith('https')) {
                    ind.className = 'secure';
                } else if (tab.url) {
                    ind.className = 'insecure';
                } else {
                    ind.className = '';
                }

                // Nav opacity
                $('btn-back').style.opacity = tab.idx > 0 ? 1 : 0.3;
                $('btn-forward').style.opacity = tab.idx < tab.history.length - 1 ? 1 : 0.3;
            },

            toggleTabSwitcher: () => {
                const sw = $('tab-switcher');
                if (sw.style.display === 'flex') {
                    sw.style.display = 'none';
                } else {
                    Groove.renderTabGrid();
                    sw.style.display = 'flex';
                }
            },

            renderTabGrid: () => {
                const grid = $('tab-grid');
                grid.innerHTML = '';
                Groove.tabs.forEach(t => {
                    const el = document.createElement('div');
                    el.className = `tab-card ${t.id === Groove.activeTabId ? 'active-card' : ''}`;
                    el.onclick = () => Groove.switchTab(t.id);
                    el.innerHTML = `
                        <div class="tab-card-preview">${t.title.charAt(0).toUpperCase()}</div>
                        <div class="tab-card-info">
                            <span class="tab-card-title">${t.title}</span>
                            <div class="tab-close-btn" onclick="Groove.closeTab(${t.id}, event)">âœ•</div>
                        </div>
                    `;
                    grid.appendChild(el);
                });
            },
            
            updateBadge: () => {
                $('tab-count-badge').innerText = Groove.tabs.length;
            },

            toggleSet: (key) => {
                Groove.settings[key] = !Groove.settings[key];
                $('tog-'+key).classList.toggle('on');
                Groove.toast(`${key.toUpperCase()} ${Groove.settings[key] ? 'Enabled' : 'Disabled'}`);
            },
            
            toast: (msg) => {
                $('toast').innerText = msg;
                $('toast').classList.add('vis');
                setTimeout(() => $('toast').classList.remove('vis'), 3000);
            }
        };

        // Boot
        window.onload = Groove.init;

    </script>
</body>
</html>
